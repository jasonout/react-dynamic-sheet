import t,{useState as n,useRef as e,useEffect as r}from"react";import o from"prop-types";import{motion as i,AnimatePresence as a,useAnimation as l}from"framer-motion";import{componentWillAppendToBody as c}from"react-append-to-body";import s from"react-measure";import u,{createGlobalStyle as d}from"styled-components";import p from"react-shadow/styled-components";import f from"modern-normalize";import m from"react-scrolllock";import h from"react-feather/dist/icons/x";import{FixedBottom as b}from"react-fixed-bottom";import g from"lodash.debounce";var y=o.oneOfType([o.string,o.func,o.node,o.arrayOf(o.node)]);function v(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}function x(){return(x=Object.assign||function(t){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t}).apply(this,arguments)}function w(t,n){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),e.push.apply(e,r)}return e}function O(t){for(var n=1;n<arguments.length;n++){var e=null!=arguments[n]?arguments[n]:{};n%2?w(Object(e),!0).forEach((function(n){v(t,n,e[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):w(Object(e)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))}))}return t}function C(t,n){if(null==t)return{};var e,r,o=function(t,n){if(null==t)return{};var e,r,o={},i=Object.keys(t);for(r=0;r<i.length;r++)e=i[r],n.indexOf(e)>=0||(o[e]=t[e]);return o}(t,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(r=0;r<i.length;r++)e=i[r],n.indexOf(e)>=0||Object.prototype.propertyIsEnumerable.call(t,e)&&(o[e]=t[e])}return o}function j(t,n){return n||(n=t.slice(0)),Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(n)}}))}function E(t,n){return function(t){if(Array.isArray(t))return t}(t)||function(t,n){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var e=[],r=!0,o=!1,i=void 0;try{for(var a,l=t[Symbol.iterator]();!(r=(a=l.next()).done)&&(e.push(a.value),!n||e.length!==n);r=!0);}catch(t){o=!0,i=t}finally{try{r||null==l.return||l.return()}finally{if(o)throw i}}return e}(t,n)||function(t,n){if(!t)return;if("string"==typeof t)return k(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);"Object"===e&&t.constructor&&(e=t.constructor.name);if("Map"===e||"Set"===e)return Array.from(t);if("Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return k(t,n)}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function k(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,r=new Array(n);e<n;e++)r[e]=t[e];return r}function P(){var t=j(["\n\t","\n\t-webkit-font-smoothing: antialiased;\n\t-moz-osx-font-smoothing: grayscale;\n\n\t* {\n\t\tbox-sizing: border-box;\n\t}\n"]);return P=function(){return t},t}var S=d(P(),f),T=function(n){var e=n.style,r=n.children,o=C(n,["style","children"]);return t.createElement(p.div,x({style:O({display:"block",overflow:"scroll",WebkitOverflowScrolling:"touch",border:0},e)},o),t.createElement(S,null),r)};function R(){var t=j(["\n\tposition: fixed;\n\tleft: 0;\n\tright: 0;\n\ttop: 0;\n\tbottom: 0;\n\tz-index: 5;\n\toverflow: auto;\n\t-webkit-overflow-scrolling: touch;\n\n\t","\n\n\t@media (min-width: 450px) {\n\t\tpadding: 20px;\n\t}\n"]);return R=function(){return t},t}function M(){var t=j(["\n\toverflow: hidden;\n\tposition: fixed;\n\tleft: 0;\n\tright: 0;\n\ttop: 0;\n\tbottom: 0;\n\tz-index: 99999999999;\n\twidth: 100vw;\n\theight: 100vh;\n"]);return M=function(){return t},t}T.propTypes={style:o.object,children:o.oneOfType([o.string,o.func,o.node,o.arrayOf(o.node)]).isRequired},T.defaultProps={style:{}};var z=u(T)(M()),H=u.div(R(),(function(t){return"number"==typeof t.contentFixBreakpoint&&"@media (min-width: 450px) and (min-height: ".concat("".concat(t.contentFixBreakpoint,"px"),") {\n\t\t\t\tdisplay: flex;\n\t\t\t\talign-items: center;\n\t\t\t\tjustify-contents: center;\n\t\t\t\toverflow: hidden;\n\t\t}")})),D=i.custom(H),N=t.forwardRef((function(n,e){var r=n.children,o=n.type,i=C(n,["children","type"]);return t.createElement(D,x({ref:e,variants:{hidden:{backgroundColor:"rgba(0, 0, 0, 0)",opacity:0,pointerEvents:"none"},visible:{backgroundColor:"menu"===o?"rgba(0, 0, 0, 0.35)":"rgba(0, 0, 0, 0.7)",opacity:1,pointerEvents:"auto"}},initial:"hidden",animate:"visible",exit:"hidden",transition:{duration:.25}},i),r)}));N.propTypes={children:y.isRequired,type:o.string},N.defaultProps={type:"modal"};var B=function(n){var e=n.children,r=C(n,["children"]);return t.createElement(z,r,t.createElement(m,null,e))};function q(){var t=j(["\n\tposition: absolute;\n\tright: 5px;\n\ttop: 5px;\n\theight: 30px;\n\twidth: 30px;\n\tpadding: 0;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tborder-radius: 4px;\n\tbackground-color: rgba(0, 0, 0, 0);\n\tcolor: rgb(120, 120, 120);\n\tz-index: 100;\n\tborder: none;\n\toutline: 0;\n\ttransition: background-color 0.25s, color 0.25s;\n\n\t&:hover {\n\t\tbackground-color: rgba(100, 100, 100, 0.1);\n\t\tcolor: rgb(100, 100, 100);\n\t\tcursor: pointer;\n\t}\n\t&:active {\n\t\tbackground-color: rgba(100, 100, 100, 0.15);\n\t}\n\t& > svg {\n\t\tstroke-width: 3px;\n\t}\n"]);return q=function(){return t},t}B.propTypes={children:y.isRequired};var F=u.button(q()),A=function(n){var e=n.onClick;return t.createElement(F,{onClick:e},t.createElement(h,{size:22}))};function I(){var t=j(["\n\tposition: relative;\n\tbox-sizing: content-box;\n\tdisplay: flex;\n\tflex-direction: row;\n\talign-items: stretch;\n\tjustify-content: center;\n"]);return I=function(){return t},t}function $(){var t=j(["\n\tmax-width: 768px;\n\tmargin: 0 auto;\n\twidth: 100%;\n\tmin-height: 100%;\n\tposition: relative;\n\tbackground-color: #fff;\n\n\t@media (min-width: 450px) {\n\t\tmin-height: auto !important;\n\t\tborder-radius: 10px;\n\t\toverflow: hidden;\n\t\tbox-shadow: 0 30px 60px -12px rgba(50, 50, 93, 0.25),\n\t\t\t0 18px 36px -18px rgba(0, 0, 0, 0.3),\n\t\t\t0 -12px 36px -8px rgba(0, 0, 0, 0.025);\n\t}\n"]);return $=function(){return t},t}A.propTypes={onClick:o.func.isRequired};var W=u.div($()),V=u.div(I()),L=i.custom(W),U=function(e){var r=e.children,o=e.isOpen,i=e.onClose,a=C(e,["children","isOpen","onClose"]),l=E(n(500),2),c=l[0],u=l[1];return o&&t.createElement(B,null,t.createElement(N,{contentFixBreakpoint:c},t.createElement(s,{bounds:!0,onResize:function(t){var n,e=t.bounds;return e.width,n=e.height,void u(n)}},(function(n){var e=n.measureRef;return t.createElement(L,x({sx:{color:"text",bg:"background"},variants:{hidden:{opacity:0,visibility:"hidden",y:20},visible:{opacity:1,visibility:"visible",y:0}},initial:"hidden",animate:"visible",exit:"hidden",transition:{duration:.25,delay:.25},ref:e},a),t.createElement(A,{onClick:i}),t.createElement(V,null,t.createElement("slot",{name:"dynamic-sheet-content"},r)))}))))};U.propTypes={children:y.isRequired,onClose:o.func.isRequired,isOpen:o.bool},U.defaultProps={isOpen:!1};var X=c(U),G="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},J=/^\s+|\s+$/g,K=/^[-+]0x[0-9a-f]+$/i,Q=/^0b[01]+$/i,Y=/^0o[0-7]+$/i,Z=parseInt,_="object"==typeof G&&G&&G.Object===Object&&G,tt="object"==typeof self&&self&&self.Object===Object&&self,nt=_||tt||Function("return this")(),et=Object.prototype.toString,rt=Math.max,ot=Math.min,it=function(){return nt.Date.now()};function at(t,n,e){var r,o,i,a,l,c,s=0,u=!1,d=!1,p=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function f(n){var e=r,i=o;return r=o=void 0,s=n,a=t.apply(i,e)}function m(t){return s=t,l=setTimeout(b,n),u?f(t):a}function h(t){var e=t-c;return void 0===c||e>=n||e<0||d&&t-s>=i}function b(){var t=it();if(h(t))return g(t);l=setTimeout(b,function(t){var e=n-(t-c);return d?ot(e,i-(t-s)):e}(t))}function g(t){return l=void 0,p&&r?f(t):(r=o=void 0,a)}function y(){var t=it(),e=h(t);if(r=arguments,o=this,c=t,e){if(void 0===l)return m(c);if(d)return l=setTimeout(b,n),f(c)}return void 0===l&&(l=setTimeout(b,n)),a}return n=ct(n)||0,lt(e)&&(u=!!e.leading,i=(d="maxWait"in e)?rt(ct(e.maxWait)||0,n):i,p="trailing"in e?!!e.trailing:p),y.cancel=function(){void 0!==l&&clearTimeout(l),s=0,r=c=o=l=void 0},y.flush=function(){return void 0===l?a:g(it())},y}function lt(t){var n=typeof t;return!!t&&("object"==n||"function"==n)}function ct(t){if("number"==typeof t)return t;if(function(t){return"symbol"==typeof t||function(t){return!!t&&"object"==typeof t}(t)&&"[object Symbol]"==et.call(t)}(t))return NaN;if(lt(t)){var n="function"==typeof t.valueOf?t.valueOf():t;t=lt(n)?n+"":n}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(J,"");var e=Q.test(t);return e||Y.test(t)?Z(t.slice(2),e?2:8):K.test(t)?NaN:+t}var st=function(t,n,e){var r=!0,o=!0;if("function"!=typeof t)throw new TypeError("Expected a function");return lt(e)&&(r="leading"in e?!!e.leading:r,o="trailing"in e?!!e.trailing:o),at(t,n,{leading:r,maxWait:n,trailing:o})};function ut(){var t=j(['\n\tposition: relative;\n\tpadding: 30px 8px calc(30px + env(safe-area-inset-bottom, 0px)) 8px;\n\toverflow: auto;\n\tz-index: 5;\n\tposition: relative;\n\tbottom: 0px;\n\tmin-height: calc(100vh - env(safe-area-inset-top, 0px) * 2);\n\tmax-height: calc(100vh - env(safe-area-inset-top, 0px) * 2);\n\tpadding-bottom: calc(30px + env(safe-area-inset-bottom, 0px)) !important;\n\tbox-sizing: content-box;\n\n\t&:before {\n\t\tcontent: "";\n\t\tposition: absolute;\n\t\tleft: 0;\n\t\tright: 0;\n\t\ttop: 8px;\n\t\theight: 6px;\n\t\twidth: 32px;\n\t\tbackground-color: #888;\n\t\topacity: 0.5;\n\t\tborder-radius: 100px;\n\t\tmargin: 0 auto;\n\t\tz-index: 100;\n\t\tborder: none;\n\t\toutline: 0;\n\t}\n\n\t& [name="dynamic-sheet-content"] > *:first-child {\n\t\tpadding-bottom: calc(env(safe-area-inset-bottom) + 8px);\n\t\ttop: 30px;\n\t\tright: 0px;\n\t\tleft: 0px;\n\t\tmax-height: calc(100vh - 96px);\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\talign-items: flex-start;\n\t\toverflow-y: scroll !important;\n\t}\n\n\t.type-menu & {\n\t\tmin-height: unset;\n\t\tpadding-bottom: max(env(safe-area-inset-bottom, 0px), 8px) !important;\n\n\t\t& [name="dynamic-sheet-content"] > *:first-child {\n\t\t\tpadding-bottom: unset;\n\t\t}\n\n\t\t:before {\n\t\t\tdisplay: none;\n\t\t}\n\t}\n']);return ut=function(){return t},t}function dt(){var t=j(["\n\tposition: absolute;\n\tleft: -100px;\n\tright: -100px;\n\ttop: 100px;\n\tbottom: -999999px;\n\tborder-radius: inherit;\n\tbackground: inherit;\n"]);return dt=function(){return t},t}function pt(){var t=j(["\n\tposition: absolute;\n\ttop: 0.75rem;\n\tright: 0.75rem;\n\tborder-radius: 50%;\n\tbackground-color: rgba(0, 0, 0, 0.25);\n\twidth: 28px;\n\theight: 28px;\n\tdisplay: flex;\n\talign-content: center;\n\talign-items: center;\n\tjustify-content: center;\n\ttext-transform: lowercase;\n\tcolor: var(--colors-text, #fff);\n"]);return pt=function(){return t},t}function ft(){var t=j(["\n\twidth: 100%;\n\tborder-radius: 9px 9px 0 0;\n\tbox-shadow: 0 30px 60px -12px rgba(50, 50, 93, 0.25),\n\t\t0 18px 36px -18px rgba(0, 0, 0, 0.3), 0 -12px 36px -8px rgba(0, 0, 0, 0.025);\n\tborder-top: solid 1px rgba(108, 108, 108, 0.25);\n\tbackdrop-filter: blur(20px);\n\topacity: 0.85;\n\tposition: relative;\n\tleft: 0;\n\tright: 0;\n\tbackground-color: #fff;\n\tbox-sizing: content-box;\n\n\t.type-menu & {\n\t\tbackground-color: unset;\n\t\tborder-top: 0;\n\t\tbox-shadow: none;\n\t\tbackdrop-filter: none;\n\t\topacity: 0.945;\n\t}\n"]);return ft=function(){return t},t}var mt=u.div(ft()),ht=u.div(pt()),bt=u.div(dt()),gt=u.div(ut()),yt=i.custom(mt),vt={Mini:{y:80,name:"mini"},Mid:{y:.5,name:"mid"},Full:{y:-8,name:"full"}},xt={DefaultSheet:[vt.Mini,vt.Mid,vt.Full]},wt=function(t,n){var e=n.bodyRect,r=n.visibleHeight,o=n.windowHeight;return t<=1&&t>=0?e.height-o*t:t<24?r+44+Math.abs(t):e.height-44-t},Ot=function(o){var i=o.children,a=o.type,c=o.onClose,s=o.snapPoints,u=void 0===s?xt.DefaultSheet:s,d=o.onClick,p=o.isModal,f=o.showClose,m=C(o,["children","type","onClose","snapPoints","onClick","isModal","showClose"]),h=E(n(!1),2),y=h[0],w=h[1],j=E(n(!1),2),k=j[0],P=j[1],S=E(n(null),2),T=S[0],R=S[1],M=l(),z=e(),H={hidden:{y:window&&window.innerHeight?window.innerHeight:"200%"},visible:{y:0}},D={top:36},q=null;if(y){var F=z.current.getBoundingClientRect(),A=F.height-window.innerHeight;q=function(t,n){var e=n.bodyRect,r=n.visibleHeight,o=n.windowHeight,i=t.map((function(t){return O(O({},t),{},{yPixel:wt(t.y,{bodyRect:e,visibleHeight:r,windowHeight:o})})}));return{getModeStateFromPixel:function(t){return i.reduce((function(n,e){var r=Math.abs(e.yPixel-t);return r<n.closest&&(n.closest=r,n.closestSnap=e.name),e.yPixel>=t&&(n.activeSnap=e.name),n}),{activeSnap:null,closest:999999,closestSnap:null})},toVariants:function(){return i.reduce((function(t,n){return Object.assign(t,v({},n.name,{y:n.yPixel}))}),{})}}}(u,{bodyRect:F,visibleHeight:A,windowHeight:window.innerHeight}),H=O(O({},H),{},{hidden:{y:2*F.height}},q.toVariants()),D={top:A+44}}else if(z.current){var I=z.current.getBoundingClientRect();H=O(O({},H),{},{hidden:{y:2*I.height}})}var $=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};return function(n){return n.preventDefault(),n.stopPropagation(),t(n)}},W=st((function(t,n){if(q)if("full"!==T){var e=z.current?z.current.getBoundingClientRect().top:n.point.y,r=q.getModeStateFromPixel(e);r.closestSnap!==T&&R(r.closestSnap)}else{z.current.childNodes[0].childNodes[0].scrollTop-=n.delta.y}}),10,{trailing:!1}),V=g((function(t,n){if(!q){var e=n.velocity.y>20&&n.point.y>0||n.velocity.y>=0&&n.point.y>45;if(p||"menu"===a)return;e&&(M.start("hidden"),R("hidden"),c())}var r=z.current?z.current.getBoundingClientRect().top:n.point.y,o=q.getModeStateFromPixel(r+n.velocity.y),i=z.current&&z.current.childNodes[0].childNodes[0];i&&("full"===T&&"full"===o.closestSnap?i.scrollTo(0,i.scrollTop-n.velocity.y):"full"!==o.closestSnap&&i.scrollTo(0,0)),R(o.closestSnap),M.start(o.closestSnap)}),250,{leading:!0,trailing:!1});r((function(){if(k){var t=z.current.getBoundingClientRect(),n=t.height>window.innerHeight/2;w(n),n?M.start((function(){return{y:t.height-window.innerHeight/2}})):M.start((function(){return{y:0}})),R("visible")}else P(!0)}),[M,k]);var L={},U={};return"menu"===a&&(L.onClick=c,U.dragTransition={damping:100,stiffness:500},D.top=0,D.bottom=0),t.createElement(B,null,t.createElement(N,x({sx:{overflow:"hidden !important"},className:"type-".concat(a),type:a},L),t.createElement(b,null,t.createElement(yt,x({sx:{color:"text",bg:"white"},drag:"y",dragElastic:.005},U,{onDrag:W,onDragEnd:V,dragConstraints:D,dragPropagation:!0,variants:H,initial:"hidden",animate:M,exit:"hidden",transition:{type:"tween",ease:"easeInOut"},onClick:$(d)},m),t.createElement(bt,{onClick:$()}),t.createElement(gt,{ref:z,className:"sz-".concat(T),$isExpandable:y},t.createElement("slot",{name:"dynamic-sheet-content"},i),f&&!p?t.createElement(ht,{className:"close-btn",onClick:function(){M.start("hidden"),R("hidden"),c()}},"X"):null)))))},Ct=function(n){var e=n.isOpen,r=C(n,["isOpen"]);return t.createElement(a,{exitBeforeEnter:!0},e&&t.createElement(Ot,r))};Ot.propTypes={children:y.isRequired,onClose:o.func.isRequired,onClick:o.func,isModal:o.bool,showClose:o.bool,type:o.string,snapPoints:o.arrayOf(o.object)},Ot.defaultProps={onClick:function(){},isModal:!1,showClose:!1,type:"modal",snapPoints:xt.DefaultSheet},Ct.propTypes={isOpen:o.bool},Ct.defaultProps={isOpen:!1};var jt=c(Ct),Et=function(n){var e=n.children,o=n.isOpen,i=n.onClose,a=n.confirmClose,l=n.confirmCloseMessage,c=n.showClose,s=n.type,u=window.innerWidth<450,d=function(){if(a&&!window.confirm(l))return!1;return i()};return r((function(){var t,n=(t=l,function(n){return(n||window.event).returnValue=t,t});return a&&(window.onbeforeunload=n,window.addEventListener("beforeunload",n,!1)),function(){window.onbeforeunload=null,window.removeEventListener("beforeunload",n,!1)}}),[a,l]),u?t.createElement(jt,{isOpen:o,onClose:d,type:s,showClose:c},e):t.createElement(X,{isOpen:o,onClose:d,type:s},e)};Et.propTypes={children:y.isRequired,isOpen:o.bool,onClose:o.func,confirmClose:o.bool,confirmCloseMessage:o.string,type:o.string,showClose:o.bool},Et.defaultProps={isOpen:!1,onClose:function(){},confirmClose:!1,confirmCloseMessage:"Are you sure you would like to abort the checkout?",type:"modal",showClose:!1};export default Et;export{jt as BottomSheet,X as Modal};
